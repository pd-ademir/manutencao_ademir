<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>{% block titulo %}ManutenÃ§Ã£o{% endblock %}</title>
  
  <!-- DependÃªncias de CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
  
  {% block extra_head %}{% endblock %}
</head>
<body class="pagina-base">

  {% if current_user.is_authenticated %}
  <!-- MENU SUPERIOR -->
  <header class="navbar">
    <div class="navbar-logo">
      <img src="{{ url_for('static', filename='logo.jpg') }}" alt="Logo">
      <span class="sistema-titulo">B64.ManutenÃ§Ã£o ğŸ› ï¸ğŸšš</span>
    </div>
    <nav class="navbar-menu">
      <ul>
        <li><a href="{{ url_for('main.index') }}">ğŸ  InÃ­cio</a></li>
        <li><a href="{{ url_for('main.plano_manutencao') }}">ğŸ—“ï¸ Plano de ManutenÃ§Ã£o</a></li>

        {# --- ALTERAÃ‡ÃƒO: Usando a funÃ§Ã£o tem_permissao para dar acesso ao adm --- #}
        {% if tem_permissao('master,adm') %}
          <li><a href="{{ url_for('main.gerenciar_usuarios') }}">ğŸ‘¥ UsuÃ¡rios</a></li>
          <li><a href="{{ url_for('main.exibir_logs') }}">ğŸ“œ Logs</a></li>
          {# A rota 'relatorios' precisa ser criada se nÃ£o existir #}
          {# <li><a href="{{ url_for('main.relatorios') }}">ğŸ“Š RelatÃ³rios</a></li> #}
          <li><a href="{{ url_for('main.kpis') }}">ğŸ“ˆ KPIs</a></li>
        {% endif %}

        <!-- UNIDADES -->
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" onclick="toggleDropdown('unidades-menu'); return false;">ğŸ¢ Unidades â–¾</a>
          <ul class="dropdown-menu" id="unidades-menu">
            <li><a href="{{ url_for('main.lista_placas') }}">Todas as Placas</a></li>
            {# Adicione outras unidades conforme necessÃ¡rio #}
          </ul>
        </li>

        <!-- AÃ‡Ã•ES -->
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" onclick="toggleDropdown('acoes-menu'); return false;">âš™ï¸ AÃ§Ãµes â–¾</a>
          <ul class="dropdown-menu" id="acoes-menu">
            <li><a href="{{ url_for('main.realizar_manutencao') }}">â• Nova ManutenÃ§Ã£o</a></li>
            <li><a href="{{ url_for('ss.solicitar_servico') }}">ğŸ“ SolicitaÃ§Ã£o de ServiÃ§o</a></li>
            {# --- ALTERAÃ‡ÃƒO: Usando a funÃ§Ã£o tem_permissao para dar acesso ao adm --- #}
            {% if tem_permissao('master,comum,adm') %}
            <li><a href="{{ url_for('ss.gerenciar_solicitacoes') }}">ğŸ”§ Gerenciar SS</a></li>
            <li><a href="{{ url_for('veiculos.gerenciar_veiculos') }}">ğŸ“‹ Gerenciar Conjuntos/Placas</a></li>
            <li><a href="{{ url_for('motoristas.gerenciar_motoristas') }}">ğŸ‘¤ Gerenciar Motoristas</a></li>
            <li><a href="{{ url_for('mass_update.index') }}">ğŸ“¤ Cadastros em Massa</a></li>
            {% endif %}
          </ul>
        </li>

        <!-- PNEUS -->
        {% if tem_permissao('master,adm') %}
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" onclick="toggleDropdown('pneus-menu'); return false;">ğŸ› Pneus â–¾</a>
          <ul class="dropdown-menu" id="pneus-menu">
             {# As rotas de pneus precisam ser criadas se nÃ£o existirem #}
            {# <li><a href="{{ url_for('main.cadastrar_estoque') }}">â• Cadastrar Pneu</a></li> #}
            {# <li><a href="{{ url_for('main.mostrar_pneus') }}">ğŸ“¤ Aplicar Pneu</a></li> #}
            {# <li><a href="{{ url_for('main.visualizar_estoque') }}">ğŸ“¦ Visualizar Estoque</a></li> #}
          </ul>
        </li>
        {% endif %}

        <!-- SAIR -->
        <li style="margin-left:auto;"><a href="{{ url_for('main.logout') }}">ğŸšª Sair</a></li>
      </ul>
    </nav>
  </header>

  <div class="boas-vindas">
    ğŸ‘‹ Bem-vindo, <strong>{{ current_user.nome }}</strong>! Que bom ter vocÃª de volta.
  </div>
  {% endif %}

  <!-- CONTEÃšDO PRINCIPAL -->
  <main class="conteudo">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% for categoria, msg in messages %}
        <div class="alert alert-{{ 'success' if categoria == 'success' else 'danger' }} mt-2">{{ msg }}</div>
      {% endfor %}
    {% endwith %}
    {% block conteudo %}{% endblock %}
  </main>

  <footer class="rodape">
    Desenvolvido por 64Bits InformÃ¡tica &copy; 
  </footer>

  {% block scripts %}
  <!-- PASSO 1: InclusÃ£o do JQUERY. Essencial para DataTables, Bootstrap JS, e scripts customizados. -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Script para controlar os menus dropdown (javascript puro, nÃ£o depende de jQuery) -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('open'));
    });
    function toggleDropdown(id) {
      const menu = document.getElementById(id);
      const isOpen = menu.classList.contains('open');
      document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('open'));
      if (!isOpen) menu.classList.add('open');
    }
    document.addEventListener('click', function (e) {
      if (!e.target.closest('.dropdown')) {
        document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('open'));
      }
    });
  </script>
  
  <!-- PASSO 2: InclusÃ£o do Bootstrap Bundle, que utiliza o jQuery para funcionalidades como o Modal. -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  {% endblock %}
</body>
</html>